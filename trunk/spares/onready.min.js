$(function(){$("#wait_img").jqm({modal:true});$("#wait_img").ajaxStart(function(){$(this).jqmShow()});$("#wait_img").ajaxStop(function(){$(this).jqmHide()});if($.browser.opera){opera.setOverrideHistoryNavigationMode("compatible")}$("#SearchForm").ajaxForm({url:"art_search.php",type:"POST",dataType:"json",data:{oper:"search_articles"},beforeSubmit:b,success:c});$("#SearchForm button").button({icons:{primary:"ui-icon-gear"}});$("#SearchForm input:text").css({height:"18px"});function b(d,f,g){var h,e,m;$("#data_tab").html("");for(h=0;h<d.length;h++){if(d[h].name=="art_code"){var j=d[h].value.toLowerCase();var l="";for(e=0;e<j.length;e++){m=j.charAt(e);if((m>="a"&&m<="z")||(m>="0"&&m<="9")){l=l+m}}d[h].value=l;$("#art_code").val(l)}if((d[h].name=="country_list"&&d[h].value=="")||(d[h].name=="art_code"&&d[h].value.length<4)){alert("Отсутствует или неправильный параметр поиска.");return false}}}function c(f){var g,e;var j=f.data;if(f.errcode){alert(f.errmess)}else{if(j.length==0){alert("Информация не найдена");return}for(g=0;g<j.length-1;g++){for(e=1;e<j.length;e++){if(j[g].sup_brand.toUpperCase()>j[e].sup_brand.toUpperCase()){var d=j[g];j[g]=j[e];j[e]=d}}}var h='<tr><td colspan="7" class="ui-state-default">Оригинальные артикулы</td></tr>';for(g=0;g<j.length;g++){if(j[g].arl_kind!=1){continue}h=h+'<tr><td style="display:none;">'+j[g].art_id+'</td><td style="white-space:nowrap;">'+j[g].sup_brand+'</td><td style="white-space:nowrap;">'+j[g].art_number+"</td><td >"+j[g].gen_name+'</td><td tecdata title="'+j[g].cri_text+'">'+((j[g].cri_text)?'<span class="ui-icon ui-icon-wrench"></span>':"")+'</td><td photo="'+j[g].photo+'">'+((j[g].photo)?'<span class="ui-icon ui-icon-search"></span>':"")+"</td><td >"+j[g].price+"</td><td >"+j[g].store+"</td><tr>"}h=h+'<tr><td colspan="7" class="ui-state-default">Заменители ( Не оригинальные артикулы )</td></tr>';for(g=0;g<j.length;g++){if(j[g].arl_kind==1){continue}h=h+'<tr><td style="display:none;">'+j[g].art_id+'</td><td style="white-space:nowrap;">'+j[g].sup_brand+'</td><td style="white-space:nowrap;">'+j[g].art_number+"</td><td >"+j[g].gen_name+'</td><td tecdata title="'+j[g].cri_text+'">'+((j[g].cri_text)?'<span class="ui-icon ui-icon-wrench"></span>':"")+'</td><td photo="'+j[g].photo+'">'+((j[g].photo)?'<span class="ui-icon ui-icon-search"></span>':"")+"</td><td >"+j[g].price+"</td><td >"+j[g].store+"</td><tr>"
}h='<table><tr class="search_panel ui-widget ui-widget-header ui-corner-all"><th style="display:none">ID</th><th>Поставщик</th><th>Артикул</th><th>Подгруппа</th><th>ТД</th><th>Фото</th><th>Цена</th><th>Кол.</th></tr>'+h+"</table>";$("#data_tab").html(h);$("td[photo] span").click(function(){var k=$(this).parent();var i=k.parent().find("td:first").text();a(i,k.attr("photo"),k.parent().find("td:eq(2)").text()+" ( "+k.parent().find("td:eq(1)").text()+" )")}).hover(function(){$(this).css({"text-decoration":"underline",cursor:"pointer"})},function(){$(this).css({"text-decoration":"none",cursor:"default"})});$("td[tecdata] span").hover(function(){$(this).css({"text-decoration":"underline",cursor:"pointer"})},function(){$(this).css({"text-decoration":"none",cursor:"default"})})}}function a(f,e,h){if(e==""||f==""){return}var g="art_"+f+"_img";if($("#"+g).html()){$("#"+g).dialog("moveToTop");return}$("#wait_img").jqmShow();$("body").append('<div id="'+g+'" style="display:none"><img src="getimg.php?id='+f+"&photo="+e+'"></div>');var d=$("#"+g+" img");d.bind("load",function(){$("#"+g).dialog({title:h,modal:false,resizable:false,height:"auto",width:"auto",stack:true,close:function(){$("#"+g).dialog("destroy");$("#"+g).remove()}});$("#wait_img").jqmHide();$("#"+g).parent().resizable({aspectRatio:true,alsoResize:d})})}});